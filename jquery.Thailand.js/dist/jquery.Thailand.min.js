/**
 * @name jquery.Thailand.js
 * @version 1.5.3.4
 * @update Feb 27, 2018
 * @website https://github.com/earthchie/jquery.Thailand.js
 * @license WTFPL v.2 - http://www.wtfpl.net/
 *
 * @dependencies: jQuery <https://jquery.com/>
 *              zip.js <https://github.com/gildas-lormeau/zip.js> (optional: for zip database_type only)
 *              typeahead.js <https://twitter.github.io/typeahead.js/>
 *              JQL.js <https://github.com/earthchie/JQL.js>
 **/
 $.Thailand=function(t){"use strict";t=$.extend({},$.Thailand.defaults,t);var e=function(t){var e,a=[],i=[],n=[];return t.lookup&&t.words&&(a=t.lookup.split("|"),i=t.words.split("|"),t=t.data),e=function(t){return"number"==typeof t&&(t=a[t]),t.replace(/[A-Z]/gi,(function(t){var e=t.charCodeAt(0);return i[e<97?e-65:26+e-97]}))},t.map((function(t){var a=1;3===t.length&&(a=2),t[a].map((function(i){i[a].map((function(r){r[a]=r[a]instanceof Array?r[a]:[r[a]],r[a].map((function(o){var c={subdistrict:e(r[0]),district:e(i[0]),province:e(t[0]),zipcode:o};2===a&&(c.subdistrict_code=r[1]||!1,c.district_code=i[1]||!1,c.province_code=t[1]||!1),n.push(c)}))}))}))})),n},a=function(t,e,i){var n,r,o,c,s=0,d=0,p=0,l=(t+="").length,u=(e+="").length;for(n=0;n<l;n+=1)for(r=0;r<u;r+=1){for(o=0;n+o<l&&r+o<u&&t.charAt(n+o)===e.charAt(r+o);)o+=1;o>p&&(p=o,s=n,d=r)}return(c=p)&&(s&&d&&(c+=a(t.substr(0,d),e.substr(0,d),!1)),s+p<l&&d+p<u&&(c+=a(t.substr(s+p,l-s-p),e.substr(d+p,u-d-p),!1))),!1===i?c:t===e?100:l>u?Math.floor(c/l*100):Math.floor(c/u*100)};!function(a){var i,n=t.database_type.toLowerCase();switch("json"!==n&&"zip"!==n&&(n=t.database.split(".").pop()),n){case"json":$.getJSON(t.database,(function(t){a(new JQL(e(t)))})).fail((function(e){throw new Error('File "'+t.database+'" is not exists.')}));break;case"zip":t.zip_worker_path||$("script").each((function(){var t=this.src.split("/");"zip.js"===t.pop()&&(zip.workerScriptsPath=t.join("/")+"/")})),(i=new XMLHttpRequest).responseType="blob",i.onreadystatechange=function(){if(4===i.readyState){if(200!==i.status)throw new Error('File "'+t.database+'" is not exists.');zip.createReader(new zip.BlobReader(i.response),(function(t){t.getEntries((function(t){t[0].getData(new zip.BlobWriter,(function(t){var i=new FileReader;i.onload=function(){a(new JQL(e(JSON.parse(i.result))))},i.readAsText(t)}))}))}))}},i.open("GET",t.database),i.send();break;default:throw new Error('Unknown database type: "'+t.database_type+'". Please define database_type explicitly (json or zip)')}}((function(e){$.Thailand.DB=e;var i,n,r={empty:" ",suggestion:function(t){return t.zipcode&&(t.zipcode=" » "+t.zipcode),"<div>"+t.subdistrict+" » "+t.district+" » "+t.province+t.zipcode+"</div>"}},o=function(e,a){for(i in t)n=i.replace("$",""),i.indexOf("$")>-1&&t.hasOwnProperty(i)&&t[i]&&a[n]&&t[i].typeahead("val",a[n]).trigger("change");"function"==typeof t.onDataFill&&(delete a.likely,t.onDataFill(a))},c="object"==typeof t.templates?Object.assign(r,t.templates):r;for(i in t)i.indexOf("$")>-1&&"$search"!==i&&t.hasOwnProperty(i)&&t[i]&&t[i].typeahead({hint:!0,highlight:!0,minLength:1},{limit:t.autocomplete_size,templates:c,source:function(t,a){var i=[],n=this.$el.data("field");try{i=e.select("*").where(n).match("^"+t).orderBy(n).fetch()}catch(t){}a(i)},display:function(t){return t[this.$el.data("field")]}}).parent().find(".tt-dataset").data("field",i.replace("$",""));for(i in t.$search&&t.$search.typeahead({hint:!0,highlight:!0,minLength:2},{limit:t.autocomplete_size,templates:c,source:function(t,i){var n=[];try{n=new JQL(n.concat(e.select("*").where("zipcode").match(t).fetch()).concat(e.select("*").where("province").match(t).fetch()).concat(e.select("*").where("district").match(t).fetch()).concat(e.select("*").where("subdistrict").match(t).fetch()).map((function(t){return JSON.stringify(t)})).filter((function(t,e,a){return a.indexOf(t)==e})).map((function(e){return(e=JSON.parse(e)).likely=[5*a(t,e.subdistrict),3*a(t,e.district.replace(/^เมือง/,"")),a(t,e.province),a(t,e.zipcode)].reduce((function(t,e){return Math.max(t,e)})),e}))).select("*").orderBy("likely desc").fetch()}catch(t){}i(n)},display:function(t){return""}}),t)i.indexOf("$")>-1&&t.hasOwnProperty(i)&&t[i]&&t[i].bind("typeahead:select typeahead:autocomplete",o).blur((function(){this.value||$(this).parent().find(".tt-dataset").html("")}));"function"==typeof t.onLoad&&t.onLoad(),"function"==typeof t.onComplete&&t.onComplete()}))},$.Thailand.defaults={database:"https://earthchie.github.io/jquery.Thailand.js/jquery.Thailand.js/database/db.json",database_type:"auto",zip_worker_path:!1,autocomplete_size:20,onLoad:function(){},onDataFill:function(){},templates:!1,$subdistrict:!1,$subdistrict_code:!1,$district:!1,$district_code:!1,$province:!1,$province_code:!1,$zipcode:!1,$search:!1},$.Thailand.setup=function(t){$.extend($.Thailand.defaults,t)};